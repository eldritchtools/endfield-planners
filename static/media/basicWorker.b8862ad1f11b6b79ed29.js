import _objectSpread from"/home/runner/work/endfield-planners/endfield-planners/node_modules/@babel/runtime/helpers/esm/objectSpread2.js";const CHUNK_LIMIT=20;self.onmessage=function(e){const{command:l,params:t}=e.data;"start"===l?computeRates(_objectSpread(_objectSpread({},t),{},{specificToggle:"Specific"===t.specificToggle})):"cancel"===l&&(cancelled=!0)};let cancelled=!1,BANNER_OPTIONS=5;function computeRates(e){let{maxPulls:l,pullsUntil6:t,pullsUntil5:n,specificToggle:o,target6:c,pullsUntil300:s}=e;const a=800*(c+1);cancelled=!1;let r=new Float64Array(a).fill(0),i=new Float64Array(a).fill(0);function f(e,l,t){return(10*e+l)*(c+1)+t}function p(e){let l=e,t=l%(c+1);l=Math.floor(l/(c+1));let n=l%10;return l=Math.floor(l/10),{p6:l,p5:n,k:t}}r[f(80-t,10-n,0)]=1;let u=0,d=0,m=0,N=1;const g=()=>{if(cancelled)return void self.postMessage({type:"done",cancelled:cancelled});const e=[];for(;e.length<20&&N<=l;){i.fill(0);let l=300-s+N;for(let e=0;e<a;e++){const l=r[e];if(l<1e-15)continue;let t,{p6:n,p5:s,k:a}=p(e);t=n<65?.008:n<79?.008+.05*(n-64):1;let N=Math.min(a+1,c);o?(i[f(0,0,N)]+=l*t/BANNER_OPTIONS,i[f(0,0,a)]+=l*t*(BANNER_OPTIONS-1)/BANNER_OPTIONS):i[f(0,0,N)]+=l*t;let g=Math.min(9===s?1:.08,1-t);i[f(n+1,0,a)]+=l*g;let h=1-t-g;i[f(n+1,s+1,a)]+=l*h,u+=l*t,d+=l*g,m+=l*h}if(300===l){[r,i]=[i,r],i.fill(0);for(let e=0;e<a;e++){const l=r[e];if(l<1e-15)continue;let{p6:t,p5:n,k:o}=p(e);const s=Math.min(o+1,c);i[f(t,n,s)]+=l}u++}let t=0,n=new Float64Array(c+1).fill(0);for(let e=0;e<a;e++){const l=i[e];if(t+=l,l<1e-15)continue;n[e%(c+1)]+=l}let g=new Float64Array(c+1).fill(0);g[c]=n[c];for(let e=c-1;e>0;e--)g[e]=n[e]+g[e+1];if(e.push({pull:N,probAtLeastK:[...g],e6:u,e5:d,e4:m}),Math.abs(t-1)>1e-12)for(let e=0;e<a;e++)i[e]/=t;[r,i]=[i,r],N++}self.postMessage({type:"results",results:e}),N>=l&&self.postMessage({type:"done",cancelled:cancelled}),setTimeout(g,0)};g()}